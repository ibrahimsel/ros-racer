# Auto-generated for 3 racecars
# Regenerate: NUM_AGENTS=3 python3 scripts/generate-compose.py > docker-compose.yml
services:
  artifact-server:
    image: nginx:alpine
    volumes:
    - ./demo/artifacts:/usr/share/nginx/html:ro
    - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
    - x11
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 256M
  novnc:
    image: theasp/novnc:latest
    environment:
    - DISPLAY_WIDTH=1920
    - DISPLAY_HEIGHT=1080
    - RUN_XTERM=no
    - RUN_FLUXBOX=yes
    ports:
    - 18080:8080
    networks:
    - x11
  sim:
    build:
      context: .
      dockerfile: Dockerfile.sim
    volumes:
    - .:/sim_ws/src/f1tenth_gym_ros
    environment:
    - DISPLAY=novnc:0.0
    - ROS_DOMAIN_ID=2
    - ROS_LOCALHOST_ONLY=0
    - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    - NUM_AGENTS=3
    depends_on:
      novnc:
        condition: service_started
    networks:
    - x11
    deploy:
      resources:
        limits:
          cpus: '2.9'
          memory: 2498M
  edge:
    build:
      context: .
      dockerfile: Dockerfile.edge
    hostname: racecar1
    environment:
    - ROS_DOMAIN_ID=2
    - ROS_LOCALHOST_ONLY=0
    - VEHICLE_NAME=racecar1
    - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    - MUTO_SYMPHONY_HOST=mosquitto
    - MUTO_SYMPHONY_API_URL=http://symphony-api:8082/v1alpha2/
    volumes:
    - ./demo:/edge/demo:ro
    networks:
    - x11
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
  edge2:
    build:
      context: .
      dockerfile: Dockerfile.edge
    hostname: racecar2
    environment:
    - ROS_DOMAIN_ID=2
    - ROS_LOCALHOST_ONLY=0
    - VEHICLE_NAME=racecar2
    - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    - MUTO_SYMPHONY_HOST=mosquitto
    - MUTO_SYMPHONY_API_URL=http://symphony-api:8082/v1alpha2/
    volumes:
    - ./demo:/edge/demo:ro
    networks:
    - x11
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
  edge3:
    build:
      context: .
      dockerfile: Dockerfile.edge
    hostname: racecar3
    environment:
    - ROS_DOMAIN_ID=2
    - ROS_LOCALHOST_ONLY=0
    - VEHICLE_NAME=racecar3
    - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    - MUTO_SYMPHONY_HOST=mosquitto
    - MUTO_SYMPHONY_API_URL=http://symphony-api:8082/v1alpha2/
    volumes:
    - ./demo:/edge/demo:ro
    networks:
    - x11
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
networks:
  x11:
    external: true
    name: ros-racer_x11

